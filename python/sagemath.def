Bootstrap: docker
From: sagemath/sagemath:latest

%labels
    Author Parameter-Selection
    Description SageMath container for lattice-estimator and mathematical computations

%post
    # Update and install additional dependencies
    apt-get update && apt-get install -y --no-install-recommends \
        build-essential \
        git \
        && apt-get clean \
        && rm -rf /var/lib/apt/lists/*

    # Install additional Python packages in Sage's Python environment
    sage -pip install numpy scipy

%environment
    export LC_ALL=C
    export SAGE_ROOT=/home/sage/sage
    export PATH=/home/sage/sage/local/bin:$PATH

%runscript
    exec sage -python "$@"

%apprun python
    exec sage -python "$@"

%apprun sage
    exec sage "$@"

%apprun ipython
    exec sage -ipython "$@"

%help
    This container provides SageMath for lattice-estimator and mathematical computations.

    Usage:
        # Run a Python script with SageMath (default)
        singularity run sagemath.sif script.py

        # Run interactive SageMath
        singularity run --app sage sagemath.sif

        # Run Python with SageMath explicitly
        singularity run --app python sagemath.sif script.py

        # Execute SageMath commands directly
        singularity exec sagemath.sif sage -c "print(factor(12345))"

        # Run with bound directory for lattice-estimator
        singularity exec --bind /path/to/python:/work sagemath.sif sage -python /work/newTFHE.py

    Build:
        singularity build sagemath.sif sagemath.def
